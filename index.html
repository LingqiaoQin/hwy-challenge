<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css">
    <!--<link rel="stylesheet" href="https://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />-->
    <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" href="http://libs.cartodb.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
  </head>
  <body>

  	<!-- Header -->
  	<div class="page-head">
  		<h1 class="page-title">THE VALUE OF HUBWAY</h1>
  	</div>

  	<!--Introduction-->
  	<div class="analysis-section">
  		<p class="analysis-paragraph">One of Hubway's significant advantages over other transportation service providers is the effectively zero marginal cost for every ride. We wanted to compare the value of each Hubway trip to a similar Uber trip and identify the areas where Hubway users generate the most value. Using the Uber apI and latitude / longitude coordinates for every Hubway station, we were able to pull uber cost and trip time data between each start and end station pair (referred to as a route) in 2016. Specifically, we used the Uber X "High Estimate" for cost and Uber X "Duration" fortrip time. For Hubway's trip time, we used the bicycling trip time from the Google Maps API, to be consistent.</p>
  	</div>

  	<!--Duration Differences-->
  	<div class="analysis-section">
  		<h1 class="section-title">Uber's Duration Advantage</h1>
  		<p class="analysis-paragraph">While each Hubway trip is obviously cheaper than an Uber journey on a marginal cost basis, Uber holds the trip time advantage for the vast majoity of routes on the system.</p>
  		<h2 class="chart-title">Hubway vs. Uber Trip Time Delta - 2016 Routes</h2>
  		<div class="tableau-wrapper">
  			<div class='tableauPlaceholder' id='viz1491831120603' style='position: relative'><noscript><a href='#'><img alt='Dashboard 1 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;du&#47;durationdeltas&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='site_root' value='' /><param name='name' value='durationdeltas&#47;Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;du&#47;durationdeltas&#47;Dashboard1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1491831120603');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='754px';vizElement.style.height='444px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
  		</div>
  		<p class="analysis-paragraph">Of the 635 routes that are faster for Hubway than Uber, most of the start and end stations are clustered around downtown and Harvard / MIT, though it's interesting that there is not 100% overlap between the 2, indicating there might be some preferable routing for one-way on some routes.</p>
  		<h2 class="chart-title">Hubway Start / End Stations with Routes Faster than Uber - 2016</h2>
  		<div class="tableau-wrapper">
			<div class='tableauPlaceholder' id='viz1491833050729' style='position: relative'><noscript><a href='#'><img alt='Dashboard 2 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;st&#47;stations-durationdeltas&#47;Dashboard2&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='site_root' value='' /><param name='name' value='stations-durationdeltas&#47;Dashboard2' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;st&#47;stations-durationdeltas&#47;Dashboard2&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1491833050729');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='1004px';vizElement.style.height='869px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
  		</div>
  	</div>

  	<div class="analysis-section">
  		<h1 class="section-title">Hubway vs. Uber</h1>
  		<!--uber linear map-->
  		<p class="analysis-paragraph"> Over the past three years, I’ve read more than 200 non-fiction books. I’ve dived into Philosophy, Marketing, Productivity, Evolution, History, Biographies, and many other books you read to learn something.</p>
  		<h2 class="chart-title">Hubway Trips - August 9, 2016 | Uber Value Differential</h2>
	    <div class="torque-wrapper">
	    	<h2 class="torque-header">
	    		<div id="torque-time-uber-linear" class="torque-timer">12:00 am EST</div>
				<div id="torque-time-value-uber-linear" class="torque-time-value">$0 per Minute</div>
				<div id="torque-saved-value-uber-linear" class="torque-saved-value">$0 Saved</div>
	    	</h2>
	    	<div class="torque-controls-value">
	      		<div class="torque-slider" id="uber_linear_v_slider"></div>
	      	</div>
	    	<div class="torque-controls-time">
	      		<div class="torque-pause" id="uber_linear_pause_button"></div>
	      		<div class="torque-slider" id="uber_linear_slider"></div>
	      	</div>
	      	<div id="uber_linear_map" class="maps" style="background:#0E0E0E"></div>
	    </div>
	    <p class="analysis-paragraph"> Over the past three years, I’ve read more than 200 non-fiction books. I’ve dived into Philosophy, Marketing, Productivity, Evolution, History, Biographies, and many other books you read to learn something.</p>

    <!--uber cumulative map-->
    	<h2 class="chart-title">Cumulative Hubway Trips - August 9, 2016 | Uber Value Differential</h2>
	    <div class="torque-wrapper">
	    	<h2 class="torque-header">
	    		<div id="torque-time-uber-cumulative" class="torque-timer">12:00 am EST</div>
				<div id="torque-time-value-uber-cumulative" class="torque-time-value">$0 per Minute</div>
				<div id="torque-saved-value-uber-cumulative" class="torque-saved-value">$0 Saved</div>
	    	</h2>
	    	<div class="torque-controls-value">
	      		<div class="torque-slider" id="uber_cumulative_v_slider"></div>
	      	</div>
	    	<div class="torque-controls-time">
	      		<div class="torque-pause" id="uber_cumulative_pause_button"></div>
	      		<div class="torque-slider" id="uber_cumulative_slider"></div>
	      	</div>
	      	<div id="uber_cumulative_map" class="maps" style="background:#0E0E0E"></div>
	    </div>
	</div>

  	<div class="analysis-section">
  		<h1 class="section-title">Hubway vs. Transit</h1>
  		<p class="analysis-paragraph"> Over the past three years, I’ve read more than 200 non-fiction books. I’ve dived into Philosophy, Marketing, Productivity, Evolution, History, Biographies, and many other books you read to learn something.</p>
  		<h2 class="chart-title">Hubway Trips - August 9, 2016 | Transit Value Differential</h2>
		    <!--transit linear map-->
		    <div class="torque-wrapper">
		    	<h2 class="torque-header">
		    		<div id="torque-time-transit-linear" class="torque-timer">12:00 am EST</div>
					<div id="torque-time-value-transit-linear" class="torque-time-value">$0 per Minute</div>
					<div id="torque-saved-value-transit-linear" class="torque-saved-value">$0 Saved</div>
		    	</h2>
		    	<div class="torque-controls-value">
		      		<div class="torque-slider" id="transit_linear_v_slider"></div>
		      	</div>
		    	<div class="torque-controls-time">
		      		<div class="torque-pause" id="transit_linear_pause_button"></div>
		      		<div class="torque-slider" id="transit_linear_slider"></div>
		      	</div>
		      	<div id="transit_linear_map" class="maps" style="background:#0E0E0E"></div>
		    </div>

    <!--transit cumulative map-->
    		<h2 class="chart-title">Cumulative Hubway Trips - August 9, 2016 | Transit Value Differential</h2>
	        <div class="torque-wrapper">
	    	<h2 class="torque-header">
	    		<div id="torque-time-transit-cumulative" class="torque-timer">12:00 am EST</div>
				<div id="torque-time-value-transit-cumulative" class="torque-time-value">$0 per Minute</div>
				<div id="torque-saved-value-transit-cumulative" class="torque-saved-value">$0 Saved</div>
	    	</h2>
	    	<div class="torque-controls-value">
	      		<div class="torque-slider" id="transit_cumulative_v_slider"></div>
	      	</div>
	    	<div class="torque-controls-time">
	      		<div class="torque-pause" id="transit_cumulative_pause_button"></div>
	      		<div class="torque-slider" id="transit_cumulative_slider"></div>
	      	</div>
	      	<div id="transit_cumulative_map" class="maps" style="background:#0E0E0E"></div>
	    	</div>
   </div>
<!-- JAVASCRIPT -->

    <!-- include cartodb.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
    <!--<script src="https://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>-->
    <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
	<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script src="http://libs.cartodb.com/cartodb.js/v3/3.15/cartodb.js"></script>
    <script>


		  $(function() {
		    $("div#uber_linear_slider").slider({
		    		step:1,
		    		max:1021,
		    		min:0,
				});
		  });

		  $(function() {
		    $("div#uber_linear_v_slider").slider({
		    		step:1,
		    		max:50,
		    		min:0,
				});
		  });

		  $(function() {
		    $("div#uber_cumulative_slider").slider({
		    		step:1,
		    		max:1021,
		    		min:0,
				});
		  });

		  $(function() {
		    $("div#uber_cumulative_v_slider").slider({
		    		step:1,
		    		max:50,
		    		min:0,
				});
		  });


		  $(function() {
		    $("div#transit_linear_slider").slider({
		    		step:1,
		    		max:1021,
		    		min:0,
				});
		  });

		  $(function() {
		    $("div#transit_linear_v_slider").slider({
		    		step:1,
		    		max:50,
		    		min:0,
				});
		  });

		  $(function() {
		    $("div#transit_cumulative_slider").slider({
		    		step:1,
		    		max:1021,
		    		min:0,
				});
		  });

		  $(function() {
		    $("div#transit_cumulative_v_slider").slider({
		    		step:1,
		    		max:50,
		    		min:0,
				});
		  });

    	function main() {
			var map_lat = 42.358611;
			var map_lng = -71.066734;

      var positive = '#ffffff';
      var negative = '#3c93a8';

		// uber_linear_map object
		    var uber_linear_map = L.map('uber_linear_map',{ center: [map_lat, map_lng], zoom: 12});

		    L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}.png', {
		    }).addTo(uber_linear_map);

			var torque_uber_linear_CARTOCSS = [
				'Map {',
				'-torque-time-attribute: "timestamp";',
				'-torque-aggregation-function: "avg(uber_value)";',
				'-torque-frame-count: 1021;',
				'-torque-animation-duration: 60;',
				'-torque-resolution: 1;',
				'-torque-data-aggregation: "linear";',
				'}',
				'#layer {',
				'  marker-width: 1;',
				'  marker-fill-opacity: 0.5;',
				'  comp-op: "lighter";',
				'}',
				'#layer[value <= 1.5] {',
				'  marker-fill: '+negative+';',
				'}',
				'#layer[value > 1.5] {',
				'  marker-fill: '+positive+';',
				'}',

			].join('\n');

			var torque_uber_linear_layer = {
			    type: 'torque',
					options: {
						query: 'SELECT (CASE WHEN (uber_cost - uber_duration_delta* 0) <= 0 THEN 1 ELSE 2 END) AS uber_value, hubway_trips_20160809.* FROM hubway_trips_20160809',
						user_name: 'pateli18',
						table_name: 'hubway_trips_uber_20160809',
						cartocss: torque_uber_linear_CARTOCSS
					}
		  		}

		  	cartodb.createLayer(uber_linear_map, torque_uber_linear_layer, {time_slider:false})
				.addTo(uber_linear_map)
				.done(function(layer) {
					// add timer
          			layer.on('change:time', function(changes) {
          				datetime = changes["time"];
          				step = changes["step"];

          				$( "div#uber_linear_slider" ).slider( "value", step);

          				if (!isNaN(datetime)) {
	          				var hours_raw = datetime.getUTCHours();
							var minutes_raw = datetime.getUTCMinutes();
							var ampm = hours_raw >= 12 ? 'pm' : 'am';
							var hours = hours_raw % 12;
							hours = hours ? hours : 12; // the hour '0' should be '12'
							var minutes = minutes_raw < 10 ? '0'+minutes_raw : minutes_raw;
							var strTime = hours + ':' + minutes + ' ' + ampm + " EST";
	          				$("div#torque-time-uber-linear").text(strTime);

	          				if(minutes_raw % 10 == 0) {
		          				var minute_in_day = hours_raw * 60 + minutes_raw;
		          				var minute_value = $( "div#uber_linear_v_slider" ).slider( "value" ) * .20
								uber_cost_sql_statement ='SELECT SUM(saved_value_all) AS saved_value FROM (SELECT AVG(uber_value) AS saved_value_all FROM (SELECT (uber_cost - uber_duration_delta *' + minute_value + ') AS uber_value, trip,minute_in_day FROM hubway_trips_20160809 WHERE minute_in_day <= ' + minute_in_day + ') AS uber_value_table GROUP BY trip) AS uber_value_table_avg';
								$.getJSON('https://pateli18.carto.com/api/v2/sql/?q='+uber_cost_sql_statement, function(data) {
									saved_value = data['rows'][0]['saved_value'];
									if(saved_value < 0) {
										$("div#torque-saved-value-uber-linear").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Lost');
										document.getElementById("torque-saved-value-uber-linear").style.color="#ff0000";
									} else {
										$("div#torque-saved-value-uber-linear").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Saved');
										document.getElementById("torque-saved-value-uber-linear").style.color="#44a93d";
									}
								});

							}
						}
					});

          			$( "div#uber_linear_v_slider" ).slider({
  						slide: function( event, ui ) {
  							var value_per_minute = ui.value*.20
							$("div#torque-time-value-uber-linear").text('$' + value_per_minute.toLocaleString('en-US', {maximumFractionDigits:2, minimumFractionDigits:2})  + ' per Minute');
  						}
					});

          			$( "div#uber_linear_v_slider" ).slider({
  						stop: function( event, ui ) {
  							var sql_query = 'SELECT (CASE WHEN (uber_cost - uber_duration_delta*' + (ui.value*.20) + ') <= 0 THEN 1 ELSE 2 END) AS uber_value, hubway_trips_20160809.* FROM hubway_trips_20160809'
  							console.log(sql_query)
  							layer.setSQL(sql_query);
  						}
					});


					$( "div#uber_linear_slider" ).slider({
  						start: function( event, ui ) {
  							layer.pause();
  							$("#uber_linear_pause_button").removeClass("torque-pause");
  							$("#uber_linear_pause_button").addClass("torque-pause play");
  						}
					});

					$( "div#uber_linear_slider" ).slider({
  						slide: function( event, ui ) {
  							layer.setStep(ui.value);
  						}
					});

					$("#uber_linear_pause_button").click(function(){
						if (layer.isRunning()) {
							$(this).removeClass("torque-pause");
							$(this).addClass("torque-pause play");
							layer.pause();
						} else {
							$(this).removeClass("torque-pause play");
							$(this).addClass("torque-pause");
							layer.play();
						}
					});

				})
				.error(function(err) {
				console.log("Error: " + err);
				});

		// uber_cumulative_map object
		    var uber_cumulative_map = L.map('uber_cumulative_map',{ center: [map_lat, map_lng], zoom: 12});

		    L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}.png', {
		    }).addTo(uber_cumulative_map);

			var torque_uber_cumulative_CARTOCSS = [
				'Map {',
				'-torque-time-attribute: "timestamp";',
				'-torque-aggregation-function: "avg(uber_value)";',
				'-torque-frame-count: 1021;',
				'-torque-animation-duration: 60;',
				'-torque-resolution: 1;',
				'-torque-data-aggregation: "cumulative";',
				'}',
				'#layer {',
				'  marker-width: 1;',
				'  marker-fill-opacity: 0.5;',
				'  comp-op: "lighter";',
				'}',
				'#layer[value <= 1.5] {',
				'  marker-fill: '+negative+';',
				'}',
				'#layer[value > 1.5] {',
				'  marker-fill: '+positive+';',
				'}',

			].join('\n');

			var torque_uber_cumulative_layer = {
			    type: 'torque',
					options: {
						query: 'SELECT (CASE WHEN (uber_cost - uber_duration_delta* 0) <= 0 THEN 1 ELSE 2 END) AS uber_value, hubway_trips_20160809.* FROM hubway_trips_20160809',
						user_name: 'pateli18',
						table_name: 'hubway_trips_uber_20160809',
						cartocss: torque_uber_cumulative_CARTOCSS
					}
		  		}

		  	cartodb.createLayer(uber_cumulative_map, torque_uber_cumulative_layer, {time_slider:false})
				.addTo(uber_cumulative_map)
				.done(function(layer) {
					// add timer
          			layer.on('change:time', function(changes) {
          				datetime = changes["time"];
          				step = changes["step"];

          				$( "div#uber_cumulative_slider" ).slider( "value", step);

          				if (!isNaN(datetime)) {
	          				var hours_raw = datetime.getUTCHours();
							var minutes_raw = datetime.getUTCMinutes();
							var ampm = hours_raw >= 12 ? 'pm' : 'am';
							var hours = hours_raw % 12;
							hours = hours ? hours : 12; // the hour '0' should be '12'
							var minutes = minutes_raw < 10 ? '0'+minutes_raw : minutes_raw;
							var strTime = hours + ':' + minutes + ' ' + ampm + " EST";
	          				$("div#torque-time-uber-cumulative").text(strTime);

	          				if(minutes_raw % 10 == 0) {
		          				var minute_in_day = hours_raw * 60 + minutes_raw;
		          				var minute_value = $( "div#uber_cumulative_v_slider" ).slider( "value" ) * .20
								uber_cost_sql_statement ='SELECT SUM(saved_value_all) AS saved_value FROM (SELECT AVG(uber_value) AS saved_value_all FROM (SELECT (uber_cost - uber_duration_delta *' + minute_value + ') AS uber_value, trip,minute_in_day FROM hubway_trips_20160809 WHERE minute_in_day <= ' + minute_in_day + ') AS uber_value_table GROUP BY trip) AS uber_value_table_avg';
								$.getJSON('https://pateli18.carto.com/api/v2/sql/?q='+uber_cost_sql_statement, function(data) {
									saved_value = data['rows'][0]['saved_value'];
									if(saved_value < 0) {
										$("div#torque-saved-value-uber-cumulative").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Lost');
										document.getElementById("torque-saved-value-uber-cumulative").style.color="#ff0000";
									} else {
										$("div#torque-saved-value-uber-cumulative").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Saved');
										document.getElementById("torque-saved-value-uber-cumulative").style.color="#44a93d";
									}
								});

							}
						}
					});

          			$( "div#uber_cumulative_v_slider" ).slider({
  						slide: function( event, ui ) {
  							var value_per_minute = ui.value*.20
							$("div#torque-time-value-uber-cumulative").text('$' + value_per_minute.toLocaleString('en-US', {maximumFractionDigits:2, minimumFractionDigits:2})  + ' per Minute');
  						}
					});

          			$( "div#uber_cumulative_v_slider" ).slider({
  						stop: function( event, ui ) {
  							var sql_query = 'SELECT (CASE WHEN (uber_cost - uber_duration_delta*' + (ui.value*.20) + ') <= 0 THEN 1 ELSE 2 END) AS uber_value, hubway_trips_20160809.* FROM hubway_trips_20160809'
  							console.log(sql_query)
  							layer.setSQL(sql_query);
  						}
					});


					$( "div#uber_cumulative_slider" ).slider({
  						start: function( event, ui ) {
  							layer.pause();
  							$("#uber_cumulative_pause_button").removeClass("torque-pause");
  							$("#uber_cumulative_pause_button").addClass("torque-pause play");
  						}
					});

					$( "div#uber_cumulative_slider" ).slider({
  						slide: function( event, ui ) {
  							layer.setStep(ui.value);
  						}
					});

					$("#uber_cumulative_pause_button").click(function(){
						if (layer.isRunning()) {
							$(this).removeClass("torque-pause");
							$(this).addClass("torque-pause play");
							layer.pause();
						} else {
							$(this).removeClass("torque-pause play");
							$(this).addClass("torque-pause");
							layer.play();
						}
					});

				})
				.error(function(err) {
				console.log("Error: " + err);
				});

// transit_linear_map object
		    var transit_linear_map = L.map('transit_linear_map',{ center: [map_lat, map_lng], zoom: 12});

		    L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}.png', {
		    }).addTo(transit_linear_map);

			var torque_transit_linear_CARTOCSS = [
				'Map {',
				'-torque-time-attribute: "timestamp";',
				'-torque-aggregation-function: "avg(transit_value)";',
				'-torque-frame-count: 1021;',
				'-torque-animation-duration: 60;',
				'-torque-resolution: 1;',
				'-torque-data-aggregation: "linear";',
				'}',
				'#layer {',
				'  marker-width: 1;',
				'  marker-fill-opacity: 0.5;',
				'  comp-op: "lighter";',
				'}',
				'#layer[value <= 1.5] {',
				'  marker-fill:  '+negative+';',
				'}',
				'#layer[value > 1.5] {',
				'  marker-fill:  '+positive+';',
				'}',

			].join('\n');

			var torque_transit_linear_layer = {
			    type: 'torque',
					options: {
						query: 'SELECT (CASE WHEN (2.25 - transit_duration_delta* 0) <= 0 THEN 1 ELSE 2 END) AS transit_value, hubway_trips_20160809.* FROM hubway_trips_20160809',
						user_name: 'pateli18',
						table_name: 'hubway_trips_transit_20160809',
						cartocss: torque_transit_linear_CARTOCSS
					}
		  		}

		  	cartodb.createLayer(transit_linear_map, torque_transit_linear_layer, {time_slider:false})
				.addTo(transit_linear_map)
				.done(function(layer) {
					// add timer
          			layer.on('change:time', function(changes) {
          				datetime = changes["time"];
          				step = changes["step"];

          				$( "div#transit_linear_slider" ).slider( "value", step);

          				if (!isNaN(datetime)) {
	          				var hours_raw = datetime.getUTCHours();
							var minutes_raw = datetime.getUTCMinutes();
							var ampm = hours_raw >= 12 ? 'pm' : 'am';
							var hours = hours_raw % 12;
							hours = hours ? hours : 12; // the hour '0' should be '12'
							var minutes = minutes_raw < 10 ? '0'+minutes_raw : minutes_raw;
							var strTime = hours + ':' + minutes + ' ' + ampm + " EST";
	          				$("div#torque-time-transit-linear").text(strTime);

	          				if(minutes_raw % 10 == 0) {
		          				var minute_in_day = hours_raw * 60 + minutes_raw;
		          				var minute_value = $( "div#transit_linear_v_slider" ).slider( "value" ) * .20
								transit_cost_sql_statement ='SELECT SUM(saved_value_all) AS saved_value FROM (SELECT AVG(transit_value) AS saved_value_all FROM (SELECT (2.25- transit_duration_delta *' + minute_value + ') AS transit_value, trip,minute_in_day FROM hubway_trips_20160809 WHERE minute_in_day <= ' + minute_in_day + ') AS transit_value_table GROUP BY trip) AS transit_value_table_avg';
								$.getJSON('https://pateli18.carto.com/api/v2/sql/?q='+transit_cost_sql_statement, function(data) {
									saved_value = data['rows'][0]['saved_value'];
									if(saved_value < 0) {
										$("div#torque-saved-value-transit-linear").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Lost');
										document.getElementById("torque-saved-value-transit-linear").style.color="#ff0000";
									} else {
										$("div#torque-saved-value-transit-linear").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Saved');
										document.getElementById("torque-saved-value-transit-linear").style.color="#44a93d";
									}
								});

							}
						}
					});

          			$( "div#transit_linear_v_slider" ).slider({
  						slide: function( event, ui ) {
  							var value_per_minute = ui.value*.20
							$("div#torque-time-value-transit-linear").text('$' + value_per_minute.toLocaleString('en-US', {maximumFractionDigits:2, minimumFractionDigits:2})  + ' per Minute');
  						}
					});

          			$( "div#transit_linear_v_slider" ).slider({
  						stop: function( event, ui ) {
  							var sql_query = 'SELECT (CASE WHEN (2.25- transit_duration_delta*' + (ui.value*.20) + ') <= 0 THEN 1 ELSE 2 END) AS transit_value, hubway_trips_20160809.* FROM hubway_trips_20160809'
  							console.log(sql_query)
  							layer.setSQL(sql_query);
  						}
					});


					$( "div#transit_linear_slider" ).slider({
  						start: function( event, ui ) {
  							layer.pause();
  							$("#transit_linear_pause_button").removeClass("torque-pause");
  							$("#transit_linear_pause_button").addClass("torque-pause play");
  						}
					});

					$( "div#transit_linear_slider" ).slider({
  						slide: function( event, ui ) {
  							layer.setStep(ui.value);
  						}
					});

					$("#transit_linear_pause_button").click(function(){
						if (layer.isRunning()) {
							$(this).removeClass("torque-pause");
							$(this).addClass("torque-pause play");
							layer.pause();
						} else {
							$(this).removeClass("torque-pause play");
							$(this).addClass("torque-pause");
							layer.play();
						}
					});

				})
				.error(function(err) {
				console.log("Error: " + err);
				});

		// transit_cumulative_map object
		    var transit_cumulative_map = L.map('transit_cumulative_map',{ center: [map_lat, map_lng], zoom: 12});

		    L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}.png', {
		    }).addTo(transit_cumulative_map);

			var torque_transit_cumulative_CARTOCSS = [
				'Map {',
				'-torque-time-attribute: "timestamp";',
				'-torque-aggregation-function: "avg(transit_value)";',
				'-torque-frame-count: 1021;',
				'-torque-animation-duration: 60;',
				'-torque-resolution: 1;',
				'-torque-data-aggregation: "cumulative";',
				'}',
				'#layer {',
				'  marker-width: 1;',
				'  marker-fill-opacity: 0.5;',
				'  comp-op: "lighter";',
				'}',
				'#layer[value <= 1.5] {',
				'  marker-fill:  '+negative+';',
				'}',
				'#layer[value > 1.5] {',
				'  marker-fill:  '+positive+';',
				'}',

			].join('\n');

			var torque_transit_cumulative_layer = {
			    type: 'torque',
					options: {
						query: 'SELECT (CASE WHEN (2.25- transit_duration_delta* 0) <= 0 THEN 1 ELSE 2 END) AS transit_value, hubway_trips_20160809.* FROM hubway_trips_20160809',
						user_name: 'pateli18',
						table_name: 'hubway_trips_transit_20160809',
						cartocss: torque_transit_cumulative_CARTOCSS
					}
		  		}

		  	cartodb.createLayer(transit_cumulative_map, torque_transit_cumulative_layer, {time_slider:false})
				.addTo(transit_cumulative_map)
				.done(function(layer) {
					// add timer
          			layer.on('change:time', function(changes) {
          				datetime = changes["time"];
          				step = changes["step"];

          				$( "div#transit_cumulative_slider" ).slider( "value", step);

          				if (!isNaN(datetime)) {
	          				var hours_raw = datetime.getUTCHours();
							var minutes_raw = datetime.getUTCMinutes();
							var ampm = hours_raw >= 12 ? 'pm' : 'am';
							var hours = hours_raw % 12;
							hours = hours ? hours : 12; // the hour '0' should be '12'
							var minutes = minutes_raw < 10 ? '0'+minutes_raw : minutes_raw;
							var strTime = hours + ':' + minutes + ' ' + ampm + " EST";
	          				$("div#torque-time-transit-cumulative").text(strTime);

	          				if(minutes_raw % 10 == 0) {
		          				var minute_in_day = hours_raw * 60 + minutes_raw;
		          				var minute_value = $( "div#transit_cumulative_v_slider" ).slider( "value" ) * .20
								transit_cost_sql_statement ='SELECT SUM(saved_value_all) AS saved_value FROM (SELECT AVG(transit_value) AS saved_value_all FROM (SELECT (2.25- transit_duration_delta *' + minute_value + ') AS transit_value, trip,minute_in_day FROM hubway_trips_20160809 WHERE minute_in_day <= ' + minute_in_day + ') AS transit_value_table GROUP BY trip) AS transit_value_table_avg';
								$.getJSON('https://pateli18.carto.com/api/v2/sql/?q='+transit_cost_sql_statement, function(data) {
									saved_value = data['rows'][0]['saved_value'];
									if(saved_value < 0) {
										$("div#torque-saved-value-transit-cumulative").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Lost');
										document.getElementById("torque-saved-value-transit-cumulative").style.color="#ff0000";
									} else {
										$("div#torque-saved-value-transit-cumulative").text('$' + saved_value.toLocaleString('en-US', {maximumFractionDigits:0}) + ' Value Saved');
										document.getElementById("torque-saved-value-transit-cumulative").style.color="#44a93d";
									}
								});

							}
						}
					});

          			$( "div#transit_cumulative_v_slider" ).slider({
  						slide: function( event, ui ) {
  							var value_per_minute = ui.value*.20
							$("div#torque-time-value-transit-cumulative").text('$' + value_per_minute.toLocaleString('en-US', {maximumFractionDigits:2, minimumFractionDigits:2})  + ' per Minute');
  						}
					});

          			$( "div#transit_cumulative_v_slider" ).slider({
  						stop: function( event, ui ) {
  							var sql_query = 'SELECT (CASE WHEN (2.25- transit_duration_delta*' + (ui.value*.20) + ') <= 0 THEN 1 ELSE 2 END) AS transit_value, hubway_trips_20160809.* FROM hubway_trips_20160809'
  							console.log(sql_query)
  							layer.setSQL(sql_query);
  						}
					});


					$( "div#transit_cumulative_slider" ).slider({
  						start: function( event, ui ) {
  							layer.pause();
  							$("#transit_cumulative_pause_button").removeClass("torque-pause");
  							$("#transit_cumulative_pause_button").addClass("torque-pause play");
  						}
					});

					$( "div#transit_cumulative_slider" ).slider({
  						slide: function( event, ui ) {
  							layer.setStep(ui.value);
  						}
					});

					$("#transit_cumulative_pause_button").click(function(){
						if (layer.isRunning()) {
							$(this).removeClass("torque-pause");
							$(this).addClass("torque-pause play");
							layer.pause();
						} else {
							$(this).removeClass("torque-pause play");
							$(this).addClass("torque-pause");
							layer.play();
						}
					});

				})
				.error(function(err) {
				console.log("Error: " + err);
				});


			}
		window.onload = main;
    </script>
  </body>
</html>
